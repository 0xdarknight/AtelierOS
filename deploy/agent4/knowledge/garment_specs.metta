(garment-type t-shirt-basic
  (category tops)
  (complexity simple)
  (smv-range 8-12-minutes)
  (fabric-main-consumption
    (xs 1.0-meters)
    (s 1.2-meters)
    (m 1.3-meters)
    (l 1.4-meters)
    (xl 1.5-meters)
    (xxl 1.7-meters))
  (pattern-efficiency 85-percent)
  (trims
    (label-main-neck 1-unit)
    (label-care-side 1-unit)
    (hangtag 1-unit)
    (thread-consumption 0.8-percent-fabric-weight))
  (operations
    (cutting 1.5-min)
    (shoulder-join 1.2-min)
    (sleeve-attach 2.0-min)
    (side-seam 1.5-min)
    (hem-bottom 1.0-min)
    (hem-sleeve 1.2-min)
    (neck-binding 2.5-min)
    (label-attach 0.8-min)
    (inspection-fold 1.0-min))
  (defect-prone-areas neck-binding shoulder-seam)
  (size-grading-increment 2cm-chest 1cm-length))

(garment-type hoodie-pullover
  (category tops)
  (complexity medium)
  (smv-range 32-38-minutes)
  (fabric-main-consumption
    (xs 1.8-meters)
    (s 2.0-meters)
    (m 2.2-meters)
    (l 2.4-meters)
    (xl 2.6-meters)
    (xxl 2.9-meters))
  (fabric-contrast-hood-lining
    (xs 0.4-meters)
    (s 0.45-meters)
    (m 0.5-meters)
    (l 0.55-meters)
    (xl 0.6-meters)
    (xxl 0.65-meters))
  (pattern-efficiency 78-percent)
  (trims
    (drawcord-5mm 1.2-meters)
    (cord-lock 2-units)
    (pocket-reinforcement-bartack 4-units)
    (label-main-neck 1-unit)
    (label-care-side 1-unit)
    (hangtag 1-unit)
    (thread-consumption 1.2-percent-fabric-weight))
  (operations
    (cutting 3.0-min)
    (pocket-construction 4.5-min)
    (shoulder-join 1.5-min)
    (sleeve-attach 3.0-min)
    (side-seam-pocket-join 3.5-min)
    (hem-bottom-ribbing 2.5-min)
    (hem-sleeve-ribbing 2.0-min)
    (hood-construction 6.0-min)
    (hood-attach 3.5-min)
    (drawcord-threading 1.5-min)
    (label-attach 1.0-min)
    (inspection-fold 2.0-min))
  (defect-prone-areas hood-symmetry pocket-alignment drawcord-threading)
  (size-grading-increment 3cm-chest 2cm-length))

(garment-type jogger-pants
  (category bottoms)
  (complexity medium)
  (smv-range 28-34-minutes)
  (fabric-main-consumption
    (xs 1.6-meters)
    (s 1.8-meters)
    (m 2.0-meters)
    (l 2.2-meters)
    (xl 2.4-meters)
    (xxl 2.7-meters))
  (pattern-efficiency 76-percent)
  (trims
    (elastic-waistband-40mm 0.9-meters)
    (drawcord-5mm 1.4-meters)
    (cord-lock 2-units)
    (elastic-ankle-25mm 0.6-meters)
    (zipper-pocket-18cm 2-units)
    (label-main-back-waist 1-unit)
    (label-care-side 1-unit)
    (hangtag 1-unit)
    (thread-consumption 1.0-percent-fabric-weight))
  (operations
    (cutting 2.5-min)
    (pocket-construction-zip 5.0-min)
    (pocket-construction-welt 4.0-min)
    (inseam 2.5-min)
    (outseam 2.5-min)
    (crotch-seam 2.0-min)
    (waistband-elastic-casing 4.5-min)
    (drawcord-threading 1.5-min)
    (ankle-cuff-elastic 3.0-min)
    (hem-finish 1.5-min)
    (bartack-stress-points 1.5-min)
    (label-attach 1.0-min)
    (inspection-fold 2.0-min))
  (defect-prone-areas crotch-seam elastic-evenness pocket-alignment)
  (size-grading-increment 2cm-waist 3cm-inseam))

(garment-type leggings-activewear
  (category bottoms)
  (complexity medium-high)
  (smv-range 22-28-minutes)
  (fabric-main-consumption
    (xs 1.4-meters)
    (s 1.5-meters)
    (m 1.7-meters)
    (l 1.9-meters)
    (xl 2.1-meters)
    (xxl 2.3-meters))
  (pattern-efficiency 82-percent)
  (trims
    (elastic-waistband-60mm 0.85-meters)
    (gusset-diamond-mesh 1-unit)
    (label-main-back-waist 1-unit)
    (label-care-inner 1-unit)
    (hangtag 1-unit)
    (thread-polyester-stretch 1.5-percent-fabric-weight))
  (operations
    (cutting 2.0-min)
    (gusset-insert 3.5-min)
    (inseam 2.0-min)
    (outseam 2.0-min)
    (crotch-seam-flatlock 3.0-min)
    (waistband-construction 5.0-min)
    (waistband-attach-coverlock 3.5-min)
    (hem-ankle-coverlock 2.5-min)
    (label-attach 0.8-min)
    (inspection-fold 1.5-min))
  (defect-prone-areas gusset-alignment waistband-roll crotch-seam-strength)
  (special-requirements 4-way-stretch-fabric flatlock-seams squat-test)
  (size-grading-increment 2cm-waist-hip 4cm-inseam))

(garment-type jacket-bomber
  (category outerwear)
  (complexity high)
  (smv-range 52-62-minutes)
  (fabric-shell-consumption
    (xs 2.2-meters)
    (s 2.4-meters)
    (m 2.6-meters)
    (l 2.8-meters)
    (xl 3.1-meters)
    (xxl 3.4-meters))
  (fabric-lining-consumption
    (xs 2.0-meters)
    (s 2.2-meters)
    (m 2.4-meters)
    (l 2.6-meters)
    (xl 2.9-meters)
    (xxl 3.2-meters))
  (pattern-efficiency 72-percent)
  (trims
    (zipper-front-ykk-5-60cm 1-unit 2.10-usd)
    (zipper-pocket-ykk-5-18cm 2-units 1.20-usd-each)
    (snap-button-metal-15mm 3-units 0.25-usd-each)
    (ribbing-cuff-wrist 0.6-meters)
    (ribbing-hem-bottom 0.9-meters)
    (ribbing-collar 0.5-meters)
    (label-main-neck 1-unit)
    (label-care-side 1-unit)
    (hangtag 1-unit)
    (thread-consumption 1.5-percent-fabric-weight))
  (operations
    (cutting-shell-lining 4.5-min)
    (pocket-construction-welt 8.0-min)
    (shell-shoulder-seam 2.0-min)
    (shell-sleeve-attach 4.0-min)
    (shell-side-seam 2.5-min)
    (lining-construction 6.0-min)
    (shell-lining-join 7.0-min)
    (zipper-install-front 5.5-min)
    (ribbing-attach-cuff 3.0-min)
    (ribbing-attach-hem 3.5-min)
    (ribbing-attach-collar 4.0-min)
    (snap-button-install 2.0-min)
    (topstitch-detail 4.5-min)
    (label-attach 1.0-min)
    (final-pressing 3.0-min)
    (inspection-fold 2.5-min))
  (defect-prone-areas zipper-alignment lining-pucker ribbing-attachment pocket-symmetry)
  (size-grading-increment 4cm-chest 2cm-length))

(= (calculate-precise-fabric-consumption $garment $size $fabric)
   (match &self
     (and (garment-type $garment (fabric-main-consumption ($size $base-meters))
                                  (pattern-efficiency $efficiency))
          (fabric $fabric (shrinkage-length $shrink-l) (shrinkage-width $shrink-w)
                         (waste-factor $waste)))
     (let* ((efficiency-factor (/ 100 $efficiency))
            (shrinkage-factor (+ 1 (/ $shrink-l 100)))
            (waste-multiplier (+ 1 (/ $waste 100)))
            (total-meters (* $base-meters efficiency-factor shrinkage-factor waste-multiplier)))
       total-meters)))

(= (calculate-trim-total-cost $garment)
   (match &self
     (garment-type $garment (trims $trim-list))
     (sum (map (lambda ($trim) (get-trim-unit-cost $trim)) $trim-list))))

(= (calculate-smv-cost $garment $labor-rate-per-minute)
   (match &self
     (garment-type $garment (smv-range $min-smv $max-smv))
     (let ((avg-smv (/ (+ $min-smv $max-smv) 2)))
       (* avg-smv $labor-rate-per-minute))))

(= (calculate-thread-cost $fabric-weight-grams $fabric-price-per-meter $thread-consumption-pct)
   (let* ((thread-weight (* $fabric-weight-grams (/ $thread-consumption-pct 100)))
          (thread-cost-estimate (* $fabric-price-per-meter 0.05)))
     thread-cost-estimate))

(quality-checkpoint pre-production-sample
  (timing before-bulk-order)
  (inspections fit-test fabric-quality construction-accuracy measurements)
  (tolerance-fit plus-minus-0.5cm)
  (tolerance-color delta-e-1.5)
  (approval-requirements design-team-signoff measurement-spec-sheet)
  (turnaround 3-5-business-days)
  (cost-per-sample 50-100-usd))

(quality-checkpoint first-article-inspection
  (timing first-20-units-of-bulk)
  (inspections construction-consistency measurement-verification defect-check)
  (tolerance-fit plus-minus-1cm)
  (tolerance-defects 0-critical 1-percent-major 2-percent-minor)
  (approval-requirements qc-manager-signoff)
  (turnaround same-day)
  (stop-production-if-failed yes))

(quality-checkpoint inline-inspection-20pct
  (timing 20-percent-production-complete)
  (inspections random-sampling-aql-2.5 workmanship-check)
  (sample-size 32-units-from-lot)
  (tolerance-defects 0-critical 1-major-allowed 3-minor-allowed)
  (corrective-action adjust-process-immediately)
  (turnaround 4-hours))

(quality-checkpoint inline-inspection-50pct
  (timing 50-percent-production-complete)
  (inspections random-sampling-aql-2.5 packaging-check)
  (sample-size 50-units-from-lot)
  (tolerance-defects 0-critical 2-major-allowed 5-minor-allowed)
  (corrective-action rework-defects-adjust-process))

(quality-checkpoint final-random-inspection
  (timing 100-percent-production-complete-before-ship)
  (inspections full-random-inspection-aql-2.5 packing-verification)
  (sample-size 80-units-from-lot)
  (tolerance-defects 0-critical 3-major-allowed 7-minor-allowed)
  (approval-requirements third-party-inspection-certificate)
  (cost-per-inspection 200-400-usd)
  (turnaround 1-business-day)
  (stop-shipment-if-failed yes))

(defect-classification critical
  (examples safety-issue sharp-object needle-breakage wrong-size-label)
  (tolerance 0-percent)
  (action 100-percent-inspection-and-rework))

(defect-classification major
  (examples seam-opening loose-stitching fabric-hole color-shade-variation)
  (tolerance 2.5-percent-aql)
  (action sort-and-rework-defects))

(defect-classification minor
  (examples thread-end-not-cut slight-stain-removable uneven-hem)
  (tolerance 4.0-percent-aql)
  (action acceptable-within-tolerance))
